name: validate-SilverSkillet
label: Full NGFW configuration assessment based on SilverSkillet

description: |
  This skillet does a full NGFW validation of IronSkillet day one configuration - panos v9.0
  Any missing config elements will result in a test fail and the doc links will provide
  GUI pointers for remediation
type: pan_validation
labels:
  collection:
    - IronSkillet
    - Validation

variables:

snippets:

  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      # capture all the xml elements referenced for validations using the full config file
      - name: interface_management_profile
        capture_object: /config/devices/entry[@name='localhost.localdomain']/network/profiles/interface-management-profile
      - name: snmp_version
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/snmp-setting/access-setting/version
      - name: dns_servers
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/dns-setting/servers
      - name: ntp_servers
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/ntp-servers
      - name: login_banner
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/login-banner
      - name: timezone
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/system/timezone
      - name: password_complexity
        capture_object: /config/mgt-config/password-complexity
      - name: zone_protect_profile
        capture_object: /config/devices/entry[@name='localhost.localdomain']/network/profiles/zone-protection-profile

  - name: interface_management_profile_a
    label: Interface Management Profile IMP-AllowPing is configured
    test: interface_management_profile | attribute_present('entry', 'name', 'IMP-AllowPing')
    fail_mesage: |
      A interface management profile called IMP-AllowPing is checked.
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#zone-protection

  - name: interface_management_profile_b
    label: Interface Management Profile IMP-ExtMgmt is configured
    test: interface_management_profile | attribute_present('entry', 'name', 'IMP-ExtMgmt')
    fail_mesage: |
      A interface management profile called IMP-ExtMgmt is checked.
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#zone-protection

  - name: snmp_v3
    label: SNMPv3 instead of older versions
    test: snmp_version | tag_present('v3')
    fail_message: |
      when using SNMP for polling and alerts use the latest v3 version in tandem with secure access credentials.
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#device-setup-operations-snmp-setup

  - name: dns_servers
    label: DNS primary and secondary servers configured
    test: |
      (
      dns_servers | tag_present('primary')
      and dns_servers | tag_present('secondary')
      )
    fail_message: |
      dns server configured is required for management/firewall access to external systems for content updates
      and access to cloud services using fqdn configuration.
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#device-setup-services-services

  - name: ntp_servers
    label: NTP primary and secondary servers configured
    test: |
      (
      ntp_servers | tag_present('primary-ntp-server.ntp-server-address')
      and ntp_servers | tag_present('secondary-ntp-server.ntp-server-address')
      )
    fail_message: |
      time server configuration is reccommended to ensure the firewall clock is in sync with external service and logging
      platforms.
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#device-setup-services-services

  - name: login_banner
    label: login banner configured
    test: login_banner | tag_present('login-banner')
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#device-setup-management-general-settings

  - name: timezone
    label: timezone set to UTC
    test: timezone | element_value('timezone') == 'UTC'
    fail_message: set to UTC so all devices map to a common universal timezone
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#device-setup-management-general-settings

  # this is a section of parse using a higher level object reference instead of multiple, granular objects
  # the test checks use the dot notation to walk down the object tree to find children and values
  - name: device_config_file
    cmd: parse
    variable: config
    outputs:
      - name: device_setting
        capture_object: /config/devices/entry[@name='localhost.localdomain']/deviceconfig/setting


  - name: zone_protect_profile
    label: ZP-Untrust zone protection is configured
    test: zone_protect_profile | attribute_present('entry', 'name', 'ZP-Untrust')
    fail_mesage: |
      A Zone Protection profile applied to a zone offers protection against most common floods, reconnaissance attacks,
      other packet-based attacks, and the use of non-IP protocols.
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#zone-protection

# sectional grouping for logging, alerts, and reporting
  - name: notifications
    cmd: parse
    variable: config
    outputs:
      # capture all the object related profile information and match configured names
      - name: log_settings
        capture_object: /config/shared/log-settings
      - name: reports
        capture_object: /config/shared/reports
      - name: report_groups
        capture_object: /config/shared/report-group
      - name: email_scheduler
        capture_object: /config/shared/email-scheduler

  - name: email_profile
    label: IronSkillet sample email profile configured
    test: |
      (
      log_settings | attribute_present('email.entry', 'name', 'Sample_Email_Profile')
      )
    fail_message: sample email profile referenced for event logging not found in the configuration
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#device-server-profiles-email

  - name: syslog_profile
    label: IronSkillet sample syslog profile configured
    test: |
      (
      log_settings | attribute_present('syslog.entry', 'name', 'Sample_Syslog_Profile')
      )
    fail_message: sample syslog profile referenced for event logging not found in the configuration
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#device-server-profiles-syslog

  - name: system_logging
    label: IronSkillet system logging configured
    test: |
      (
      log_settings | attribute_present('system.match-list.entry', 'name', 'Email_Critical_System_Logs')
      and log_settings | attribute_present('system.match-list.entry', 'name', 'System_Log_Forwarding')
      and log_settings | attribute_present('config.match-list.entry', 'name', 'Configuration_Log_Forwarding')
      )
    fail_message: recommended system event logging configuration not found
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#device-log-settings-system

  - name: reports
    label: IronSkillet threat reports configured
    test: |
      (
      reports | attribute_present('entry', 'name', 'Host-visit malicious sites plus')
      and reports | attribute_present('entry', 'name', 'Hosts visit malicious sites')
      and reports | attribute_present('entry', 'name', 'Hosts visit questionable sites')
      and reports | attribute_present('entry', 'name', 'Host-visit quest sites plus')
      and reports | attribute_present('entry', 'name', 'Wildfire malicious verdicts')
      and reports | attribute_present('entry', 'name', 'Wildfire verdicts SMTP')
      and reports | attribute_present('entry', 'name', 'Clients sinkholed')
      )
    fail_message: recommended threat reports used in the report group not found in the configuration
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#ironskillet-custom-reports

  - name: report_group
    label: Possible Compromise threat report group configured
    test: |
      (
      report_groups | attribute_present('entry', 'name', 'Possible Compromise')
      )
    fail_message: report group 'Possible Compromise' not found in the configuration
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#report-groups

  - name: email_scheduler
    label: Possible Compromise report email scheduler configured
    test: |
      (
      email_scheduler | attribute_present('entry', 'name', 'Possible Compromise')
      )
    fail_message: email scheduling for reports is not currently configured
    documentation_link: https://iron-skillet.readthedocs.io/en/docs_master/viz_guide_panos.html#monitor-pdf-reports-email-scheduler
